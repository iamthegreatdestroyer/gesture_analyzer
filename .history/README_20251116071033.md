# GestureAnalyzer

A personal desktop application to detect, analyze, and catalog hand gestures from local video files.

## Features

- Load local videos (MP4, AVI, etc.)
- Detect hands and landmarks with MediaPipe
- Analyze patterns (repetitions, simple motion sequences)
- Store results locally in SQLite
- Desktop UI via PyQt5
- Containerized with Docker Compose

## Quickstart (Windows PowerShell)

```powershell
# From the project root
python -m venv venv
./venv/Scripts/Activate.ps1
pip install -r requirements.txt
python app.py
```

## Run Tests

```powershell
./venv/Scripts/Activate.ps1
pytest -q
```

## Docker

GUI apps are not ideal in containers on Windows, but you can still build
and run the backend to verify dependencies and use headless processing.

```powershell
docker compose up --build
```

Data persists in `./data` (mounted into the container at `/app/data`).

### Optional: MediaPipe installation

MediaPipe is supported but optional. The app runs with a graceful
fallback if MediaPipe is not available and marks summaries with
`mediapipe_unavailable: true`.

- Local install (recommended when wheels are available):

  ```powershell
  ./venv/Scripts/Activate.ps1
  pip install --upgrade pip
  pip install mediapipe==0.10.14
  ```

  Notes:

  - Install `numpy` first if pip tries to build from source.
  - If you see protobuf errors, try pinning a compatible version, e.g.
    `pip install "protobuf<5"` before installing MediaPipe.

- Docker (optional build arg):

  The provided `Dockerfile` supports an opt‑in MediaPipe install via
  a build argument. Example:

  ```powershell
  docker build --build-arg WITH_MEDIAPIPE=1 -t gesture-analyzer .
  ```

  If the wheel is not available for your base image, the build may fail.
  In that case, omit the arg and use the fallback behavior.

## Project Structure

- `app.py` – PyQt5 GUI entrypoint
- `gesture_analyzer.py` – CV processing and pattern analysis
- `db.py` – SQLite catalog utilities
- `tests/` – pytest tests
- `Dockerfile`, `docker-compose.yml` – container setup
- `requirements.txt` – dependencies
- `batch_cli.py` – headless batch processor (JSON/CSV output)

## CLI Batch Processing

You can process multiple videos from a directory without the GUI:

```powershell
./venv/Scripts/python batch_cli.py --input-dir .\videos --pattern *.mp4 \
	--format json --output results.json --save-db
```

Flags:

- `--input-dir PATH`: directory with videos
- `--pattern GLOB`: filename pattern (default `*.mp4`)
- `--max-frames N`: optional frame cap per video
- `--format {json,csv}`: output format
- `--output FILE`: write to a file; if omitted, prints summary
- `--save-db`: persist each run to SQLite
- `--mapping FILE`: override gesture mapping JSON

## Logging

Logging is enabled by default and prints to stdout. Control verbosity
with environment variables or CLI flags.

- `GESTURE_LOG_LEVEL`: one of `DEBUG`, `INFO`, `WARNING`, `ERROR`
  (default `INFO`).
- `GESTURE_LOG_FORMAT`: optional `logging` format string.

Examples (PowerShell):

```powershell
$env:GESTURE_LOG_LEVEL = "DEBUG"
./venv/Scripts/python app.py
```

Batch CLI with reduced noise:

```powershell
./venv/Scripts/python batch_cli.py --input-dir .\videos --quiet
```

Docker example:

```powershell
docker run -e GESTURE_LOG_LEVEL=DEBUG gesture-analyzer
```

## Troubleshooting

- MediaPipe install fails (no wheel / building from source):
  - Upgrade pip and install `numpy` first: `pip install --upgrade pip numpy`
  - Pin a compatible protobuf: `pip install "protobuf<5"`
  - Use a known version: `pip install mediapipe==0.10.14`
  - If wheels are not available for your Python/OS/arch, try Python 3.10/3.11
    or run without MediaPipe (the app will gracefully fall back).
- ImportError: mediapipe not found at runtime:
  - The app continues with `mediapipe_unavailable: true`; install MediaPipe to
    enable hand landmark extraction.
- OpenCV cannot open video (ffmpeg/codec issues):
  - On Linux, ensure `ffmpeg` is installed (Dockerfile already does this).
  - Try `opencv-contrib-python` as an alternative, or re-encode the video to
    H.264/AAC MP4.
- OpenCV missing GUI/GL libraries on Linux:
  - Install `libgl1` and `libglib2.0-0` (Dockerfile shows exact packages).
